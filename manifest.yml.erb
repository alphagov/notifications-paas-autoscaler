---

applications:
  - name: notify-paas-autoscaler
    buildpack: python_buildpack
    command: ./run.sh python main.py
    health-check-type: none
    no-route: true
    instances: 1
    memory: 128M
    env:
      AWS_REGION: eu-west-1
      SCHEDULE_INTERVAL: 5
      SCHEDULED_SCALE_FACTOR: 0.6
      COOLDOWN_SECONDS_AFTER_SCALE_UP: 300
      COOLDOWN_SECONDS_AFTER_SCALE_DOWN: 60
      CF_API_URL: https://api.cloud.service.gov.uk
      CF_ORG: govuk-notify
      CF_SPACE: <%= ENV.fetch("CF_SPACE") %>
      STATSD_ENABLED: <%= ENV.fetch("STATSD_ENABLED") %>
      SQS_QUEUE_PREFIX: <%= ENV.fetch("SQS_QUEUE_PREFIX") %>
      PYTHONUNBUFFERED: 1
      CF_MIN_INSTANCE_COUNT_LOW: <%= ENV.fetch("CF_MIN_INSTANCE_COUNT_LOW", "1") %>
      CF_MIN_INSTANCE_COUNT_HIGH: <%= ENV.fetch("CF_MIN_INSTANCE_COUNT_HIGH", "1") %>
      CF_MAX_INSTANCE_COUNT_LOW: <%= ENV.fetch("CF_MAX_INSTANCE_COUNT_LOW", "1") %>
      CF_MAX_INSTANCE_COUNT_MEDIUM: <%= ENV.fetch("CF_MAX_INSTANCE_COUNT_MEDIUM", "1") %>
      CF_MAX_INSTANCE_COUNT_HIGH: <%= ENV.fetch("CF_MAX_INSTANCE_COUNT_HIGH", "1") %>
      CF_MAX_INSTANCE_COUNT_V_HIGH: <%= ENV.fetch("CF_MAX_INSTANCE_COUNT_V_HIGH", "1") %>
      CF_BUFFER_INSTANCES: <%= ENV.fetch("CF_BUFFER_INSTANCES", "1") %>
    services:
      - notify-paas-autoscaler
      - notify-db
